"use strict";var e=require("../logger-04bad527.cjs"),s=require("../session-ef1ef979.cjs"),r=require("../index-59b7992d.cjs"),t=require("../utils-9d882195.cjs");require("../query-promise-2c5b43ab.cjs"),require("../query-builder-2f2e8229.cjs"),require("../column-builder-b48639f3.cjs");class i extends s.PreparedQuery{constructor(e,s,r,t,i){super(),this.client=e,this.params=r,this.logger=t,this.fields=i,this.query=s}execute(e={}){const s=r.fillPlaceholders(this.params,e);this.logger.logQuery(this.query,s);const{fields:i,query:n,client:o,joinsNotNullableMap:l}=this;if(!i)return o.unsafe(n,s);return o.unsafe(n,s).values().then((e=>e.map((e=>t.mapResultRow(i,e,l)))))}all(e={}){const s=r.fillPlaceholders(this.params,e);return this.logger.logQuery(this.query,s),this.client.unsafe(this.query,s)}values(e={}){const s=r.fillPlaceholders(this.params,e);return this.logger.logQuery(this.query,s),this.client.unsafe(this.query,s).values()}}class n extends s.PgSession{constructor(s,r,t={}){super(r),this.client=s,this.options=t,this.logger=t.logger??new e.NoopLogger}prepareQuery(e,s){return new i(this.client,e.sql,e.params,this.logger,s)}query(e,s){return this.logger.logQuery(e,s),this.client.unsafe(e,s).values()}queryObjects(e,s){return this.client.unsafe(e,s)}transaction(e,s){return this.client.begin((async r=>{const t=new n(r,this.dialect,this.options),i=new o(this.dialect,t);return s&&await i.setTransaction(s),e(i)}))}}class o extends s.PgTransaction{constructor(e,s,r=0){super(e,s,r),this.session=s}transaction(e){return this.session.client.savepoint((s=>{const r=new n(s,this.dialect,this.session.options),t=new o(this.dialect,r);return e(t)}))}}exports.PostgresJsPreparedQuery=i,exports.PostgresJsSession=n,exports.PostgresJsTransaction=o,exports.drizzle=function(r,t={}){const i=new s.PgDialect;let o;!0===t.logger?o=new e.DefaultLogger:!1!==t.logger&&(o=t.logger);const l=new n(r,i,{logger:o});return new s.PgDatabase(i,l)};
//# sourceMappingURL=index.cjs.map
