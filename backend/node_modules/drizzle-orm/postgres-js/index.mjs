import{N as s,D as e}from"../logger-2598bf05.mjs";import{P as t,a as r,b as i,d as n,c as o}from"../session-c891400d.mjs";import{k as a}from"../index-b71998f1.mjs";import{m as l}from"../utils-e6870670.mjs";import"../query-promise-a65edd44.mjs";import"../query-builder-2fcde2f0.mjs";import"../column-builder-592f0191.mjs";class u extends t{constructor(s,e,t,r,i){super(),this.client=s,this.params=t,this.logger=r,this.fields=i,this.query=e}execute(s={}){const e=a(this.params,s);this.logger.logQuery(this.query,e);const{fields:t,query:r,client:i,joinsNotNullableMap:n}=this;if(!t)return i.unsafe(r,e);return i.unsafe(r,e).values().then((s=>s.map((s=>l(t,s,n)))))}all(s={}){const e=a(this.params,s);return this.logger.logQuery(this.query,e),this.client.unsafe(this.query,e)}values(s={}){const e=a(this.params,s);return this.logger.logQuery(this.query,e),this.client.unsafe(this.query,e).values()}}class c extends r{constructor(e,t,r={}){super(t),this.client=e,this.options=r,this.logger=r.logger??new s}prepareQuery(s,e){return new u(this.client,s.sql,s.params,this.logger,e)}query(s,e){return this.logger.logQuery(s,e),this.client.unsafe(s,e).values()}queryObjects(s,e){return this.client.unsafe(s,e)}transaction(s,e){return this.client.begin((async t=>{const r=new c(t,this.dialect,this.options),i=new h(this.dialect,r);return e&&await i.setTransaction(e),s(i)}))}}class h extends i{constructor(s,e,t=0){super(s,e,t),this.session=e}transaction(s){return this.session.client.savepoint((e=>{const t=new c(e,this.dialect,this.session.options),r=new h(this.dialect,t);return s(r)}))}}function g(s,t={}){const r=new o;let i;!0===t.logger?i=new e:!1!==t.logger&&(i=t.logger);const a=new c(s,r,{logger:i});return new n(r,a)}export{u as PostgresJsPreparedQuery,c as PostgresJsSession,h as PostgresJsTransaction,g as drizzle};
//# sourceMappingURL=index.mjs.map
