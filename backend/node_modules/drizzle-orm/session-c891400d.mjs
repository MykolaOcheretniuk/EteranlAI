import{o as e,a as t,g as s,b as i,c as n,T as r}from"./utils-e6870670.mjs";import{T as o,e as a,P as c,s as l,o as h,V as u,v as f,C as d,n as p,u as g,m,l as w,W as y}from"./index-b71998f1.mjs";import{Q as b}from"./query-promise-a65edd44.mjs";import{T as v}from"./query-builder-2fcde2f0.mjs";import{C as S}from"./column-builder-592f0191.mjs";class $ extends b{constructor(e,t,s){super(),this.session=t,this.dialect=s,this.execute=e=>this._prepare().execute(e),this.config={table:e}}where(e){return this.config.where=e,this}returning(t=this.config.table[o.Symbol.Columns]){return this.config.returning=e(t),this}getSQL(){return this.dialect.buildDeleteQuery(this.config)}toSQL(){const{typings:e,...t}=this.dialect.sqlToQuery(this.getSQL());return t}_prepare(e){return this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e)}prepare(e){return this._prepare(e)}}class x{constructor(e,t,s){this.table=e,this.session=t,this.dialect=s}values(e){if(0===(e=Array.isArray(e)?e:[e]).length)throw new Error("values() must be called with at least one value");const t=e.map((e=>{const t={},s=this.table[o.Symbol.Columns];for(const i of Object.keys(e)){const n=e[i];t[i]=n instanceof a?n:new c(n,s[i])}return t}));return new N(this.table,t,this.session,this.dialect)}}class N extends b{constructor(e,t,s,i){super(),this.session=s,this.dialect=i,this.execute=e=>this._prepare().execute(e),this.config={table:e,values:t}}returning(t=this.config.table[o.Symbol.Columns]){return this.config.returning=e(t),this}onConflictDoNothing(e={}){if(void 0===e.target)this.config.onConflict=l`do nothing`;else{let t="";t=Array.isArray(e.target)?e.target.map((e=>this.dialect.escapeName(e.name))).join(","):this.dialect.escapeName(e.target.name);const s=e.where?l` where ${e.where}`:l``;this.config.onConflict=l`(${l.raw(t)})${s} do nothing`}return this}onConflictDoUpdate(e){const s=e.where?l` where ${e.where}`:l``,i=this.dialect.buildUpdateSet(this.config.table,t(this.config.table,e.set));let n="";return n=Array.isArray(e.target)?e.target.map((e=>this.dialect.escapeName(e.name))).join(","):this.dialect.escapeName(e.target.name),this.config.onConflict=l`(${l.raw(n)})${s} do update set ${i}`,this}getSQL(){return this.dialect.buildInsertQuery(this.config)}toSQL(){const{typings:e,...t}=this.dialect.sqlToQuery(this.getSQL());return t}_prepare(e){return this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e)}prepare(e){return this._prepare(e)}}var T,Q;const q=Symbol("InlineForeignKeys"),C=Symbol("ExtraConfigBuilder");class L extends o{constructor(){super(...arguments),this[T]=[],this[Q]=void 0}}function j(e,t,s,i,n=e){const r=new L(e,i,n),a=Object.fromEntries(Object.entries(t).map((([e,t])=>{const s=t.build(r);return r[q].push(...t.buildForeignKeys(s,r)),[e,s]}))),c=Object.assign(r,a);return c[o.Symbol.Columns]=a,s&&(c[L.Symbol.ExtraConfigBuilder]=s),c}T=q,Q=C,L.Symbol=Object.assign({},o.Symbol,{InlineForeignKeys:q,ExtraConfigBuilder:C});const z=(e,t,s)=>j(e,t,s,void 0);function B(e){return(t,s,i)=>j(e(t),s,i,void 0,t)}class D{constructor(e,t){this.name=e,this.value=t}build(e){return new _(e,this)}}class _{constructor(e,t){this.table=e,this.name=t.name,this.value=t.value}}function A(e,t){return new D(e,t)}class O{constructor(e,t){this._onUpdate="no action",this._onDelete="no action",this.reference=()=>{const{columns:t,foreignColumns:s}=e();return{columns:t,foreignTable:s[0].table,foreignColumns:s}},t&&(this._onUpdate=t.onUpdate,this._onDelete=t.onDelete)}onUpdate(e){return this._onUpdate=void 0===e?"no action":e,this}onDelete(e){return this._onDelete=void 0===e?"no action":e,this}build(e){return new P(e,this)}}class P{constructor(e,t){this.table=e,this.reference=t.reference,this.onUpdate=t._onUpdate,this.onDelete=t._onDelete}getName(){const{columns:e,foreignColumns:t}=this.reference(),s=e.map((e=>e.name)),i=t.map((e=>e.name));return`${[this.table[L.Symbol.Name],...s,t[0].table[L.Symbol.Name],...i].join("_")}_fk`}}function F(e){return new O((function(){const{columns:t,foreignColumns:s}=e;return{columns:t,foreignColumns:s}}))}class E{constructor(e,t){this.unique=e,this.name=t}on(...e){return new M(e,this.unique,!1,this.name)}onOnly(...e){return new M(e,this.unique,!0,this.name)}}class M{constructor(e,t,s,i){this.config={name:i,columns:e,unique:t,only:s}}concurrently(){return this.config.concurrently=!0,this}using(e){return this.config.using=e,this}asc(){return this.config.order="asc",this}desc(){return this.config.order="desc",this}nullsFirst(){return this.config.nulls="first",this}nullsLast(){return this.config.nulls="last",this}where(e){return this.config.where=e,this}build(e){return new k(this.config,e)}}class k{constructor(e,t){this.config={...e,table:t}}}function V(e){return new E(!1,e)}function U(e){return new E(!0,e)}function I(...e){return new J(e)}class J{constructor(e){this.columns=e}build(e){return new K(e,this.columns)}}class K{constructor(e,t){this.table=e,this.columns=t}getName(){return`${this.table[L.Symbol.Name]}_${this.columns.map((e=>e.name)).join("_")}_pk`}}class R{constructor(e,t){this.name=e,this.schema=t,this.config={}}with(e){return this.config.with=e,this}}class Y extends R{as(e){"function"==typeof e&&(e=e(new Xe));const t=new h({alias:this.name,sqlBehavior:"error",sqlAliasedBehavior:"alias",replaceOriginalName:!0}),s=new Proxy(e.getSelectedFields(),t);return new Proxy(new te({pgConfig:this.config,config:{name:this.name,schema:this.schema,selectedFields:s,query:e.getSQL().inlineParams()}}),t)}}class W extends R{constructor(e,t,i){super(e,i),this.columns=s(z(e,t))}existing(){return new Proxy(new te({pgConfig:void 0,config:{name:this.name,schema:this.schema,selectedFields:this.columns,query:void 0}}),new h({alias:this.name,sqlBehavior:"error",sqlAliasedBehavior:"alias",replaceOriginalName:!0}))}as(e){return new Proxy(new te({pgConfig:this.config,config:{name:this.name,schema:this.schema,selectedFields:this.columns,query:e.inlineParams()}}),new h({alias:this.name,sqlBehavior:"error",sqlAliasedBehavior:"alias",replaceOriginalName:!0}))}}class X{constructor(e,t){this.name=e,this.schema=t,this.config={}}using(e){return this.config.using=e,this}with(e){return this.config.with=e,this}tablespace(e){return this.config.tablespace=e,this}withNoData(){return this.config.withNoData=!0,this}}class H extends X{as(e){"function"==typeof e&&(e=e(new Xe));const t=new h({alias:this.name,sqlBehavior:"error",sqlAliasedBehavior:"alias",replaceOriginalName:!0}),s=new Proxy(e.getSelectedFields(),t);return new Proxy(new ie({pgConfig:{with:this.config.with,using:this.config.using,tablespace:this.config.tablespace,withNoData:this.config.withNoData},config:{name:this.name,schema:this.schema,selectedFields:s,query:e.getSQL().inlineParams()}}),t)}}class G extends X{constructor(e,t,i){super(e,i),this.columns=s(z(e,t))}existing(){return new Proxy(new ie({pgConfig:void 0,config:{name:this.name,schema:this.schema,selectedFields:this.columns,query:void 0}}),new h({alias:this.name,sqlBehavior:"error",sqlAliasedBehavior:"alias",replaceOriginalName:!0}))}as(e){return new Proxy(new ie({pgConfig:void 0,config:{name:this.name,schema:this.schema,selectedFields:this.columns,query:e.inlineParams()}}),new h({alias:this.name,sqlBehavior:"error",sqlAliasedBehavior:"alias",replaceOriginalName:!0}))}}class Z extends u{}const ee=Symbol("PgViewConfig");class te extends Z{constructor({pgConfig:e,config:t}){super(t),e&&(this[ee]={with:e.with})}}const se=Symbol("PgMaterializedViewConfig");class ie extends Z{constructor({pgConfig:e,config:t}){super(t),this[se]={with:e?.with,using:e?.using,tablespace:e?.tablespace,withNoData:e?.withNoData}}}function ne(e,t,s){return t?new W(e,t,s):new Y(e,s)}function re(e,t,s){return t?new G(e,t,s):new H(e,s)}function oe(e,t){return ne(e,t,void 0)}function ae(e,t){return re(e,t,void 0)}function ce(e){const t=Object.values(e[o.Symbol.Columns]),s=[],i=[],n=[],r=Object.values(e[L.Symbol.InlineForeignKeys]),a=e[o.Symbol.Name],c=e[o.Symbol.Schema],l=e[L.Symbol.ExtraConfigBuilder];if(void 0!==l){const t=l(e[o.Symbol.Columns]);for(const o of Object.values(t))o instanceof M?s.push(o.build(e)):o instanceof D?i.push(o.build(e)):o instanceof J?n.push(o.build(e)):o instanceof O&&r.push(o.build(e))}return{columns:t,indexes:s,foreignKeys:r,checks:i,primaryKeys:n,name:a,schema:c}}function le(e){return{...e[f],...e[ee]}}function he(e){return{...e[f],...e[se]}}function ue(e,t,s){for(let i=t;i<e.length;i++){const n=e[i];if("\\"!==n){if('"'===n)return[e.slice(t,i).replace(/\\/g,""),i+1];if(!s&&(","===n||"}"===n))return[e.slice(t,i).replace(/\\/g,""),i]}else i++}return[e.slice(t).replace(/\\/g,""),e.length]}function fe(e,t=0){const s=[];let i=t,n=!1;for(;i<e.length;){const r=e[i];if(","===r){(n||i===t)&&s.push(""),n=!0,i++;continue}if(n=!1,"\\"===r){i+=2;continue}if('"'===r){const[t,n]=ue(e,i+1,!0);s.push(t),i=n;continue}if("}"===r)return[s,i+1];if("{"===r){const[t,n]=fe(e,i+1);s.push(t),i=n;continue}const[o,a]=ue(e,i,!1);s.push(o),i=a}return[s,i]}function de(e){const[t]=fe(e,1);return t}function pe(e){return`{${e.map((e=>Array.isArray(e)?pe(e):"string"==typeof e&&e.includes(",")?`"${e.replace(/"/g,'\\"')}"`:`${e}`)).join(",")}}`}class ge extends S{constructor(){super(...arguments),this.foreignKeyConfigs=[]}array(e){return new we(this.config.name,this,e)}references(e,t={}){return this.foreignKeyConfigs.push({ref:e,actions:t}),this}buildForeignKeys(e,t){return this.foreignKeyConfigs.map((({ref:s,actions:i})=>((s,i)=>{const n=new O((()=>{const t=s();return{columns:[e],foreignColumns:[t]}}));return i.onUpdate&&n.onUpdate(i.onUpdate),i.onDelete&&n.onDelete(i.onDelete),n.build(t)})(s,i)))}}class me extends d{}class we extends ge{constructor(e,t,s){super(e),this.config.baseBuilder=t,this.config.size=s}build(e){const t=this.config.baseBuilder.build(e);return new ye(e,this.config,t)}}class ye extends me{constructor(e,t,s,i){super(e,t),this.baseColumn=s,this.range=i,this.size=t.size}getSQLType(){return`${this.baseColumn.getSQLType()}[${"number"==typeof this.size?this.size:""}]`}mapFromDriverValue(e){return"string"==typeof e&&(e=de(e)),e.map((e=>this.baseColumn.mapFromDriverValue(e)))}mapToDriverValue(e,t=!1){const s=e.map((e=>null===e?null:this.baseColumn instanceof ye?this.baseColumn.mapToDriverValue(e,!0):this.baseColumn.mapToDriverValue(e)));return t?s:pe(s)}}class be extends ge{defaultNow(){return this.default(l`now()`)}}class ve extends be{build(e){return new Se(e,this.config)}}class Se extends me{getSQLType(){return"date"}mapFromDriverValue(e){return new Date(e)}mapToDriverValue(e){return e.toISOString()}}class $e extends be{build(e){return new xe(e,this.config)}}class xe extends me{getSQLType(){return"date"}}function Ne(e,t){return"date"===t?.mode?new ve(e):new $e(e)}class Te extends ge{build(e){return new Qe(e,this.config)}}class Qe extends me{constructor(e,t){super(e,t)}getSQLType(){return"json"}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){if("string"==typeof e)try{return JSON.parse(e)}catch{return e}return e}}function qe(e){return new Te(e)}class Ce extends ge{build(e){return new Le(e,this.config)}}class Le extends me{constructor(e,t){super(e,t)}getSQLType(){return"jsonb"}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){if("string"==typeof e)try{return JSON.parse(e)}catch{return e}return e}}function je(e){return new Ce(e)}class ze extends ge{constructor(e,t,s){super(e),this.config.precision=t,this.config.scale=s}build(e){return new Be(e,this.config)}}class Be extends me{constructor(e,t){super(e,t),this.precision=t.precision,this.scale=t.scale}getSQLType(){return void 0!==this.precision&&void 0!==this.scale?`numeric(${this.precision}, ${this.scale})`:void 0===this.precision?"numeric":`numeric(${this.precision})`}}function De(e,t){return new ze(e,t?.precision,t?.scale)}const _e=De;class Ae extends be{constructor(e,t,s){super(e),this.withTimezone=t,this.precision=s,this.config.withTimezone=t,this.config.precision=s}build(e){return new Oe(e,this.config)}}class Oe extends me{constructor(e,t){super(e,t),this.withTimezone=t.withTimezone,this.precision=t.precision}getSQLType(){return`time${void 0===this.precision?"":`(${this.precision})`}${this.withTimezone?" with time zone":""}`}}function Pe(e,t={}){return new Ae(e,t.withTimezone??!1,t.precision)}class Fe extends be{constructor(e,t,s){super(e),this.config.withTimezone=t,this.config.precision=s}build(e){return new Ee(e,this.config)}}class Ee extends me{constructor(e,t){super(e,t),this.mapFromDriverValue=e=>new Date(this.withTimezone?e:e+"+0000"),this.mapToDriverValue=e=>this.withTimezone?e.toUTCString():e.toISOString(),this.withTimezone=t.withTimezone,this.precision=t.precision}getSQLType(){return`timestamp${void 0===this.precision?"":` (${this.precision})`}${this.withTimezone?" with time zone":""}`}}class Me extends be{constructor(e,t,s){super(e),this.config.withTimezone=t,this.config.precision=s}build(e){return new ke(e,this.config)}}class ke extends me{constructor(e,t){super(e,t),this.withTimezone=t.withTimezone,this.precision=t.precision}getSQLType(){return`timestamp${void 0===this.precision?"":`(${this.precision})`}${this.withTimezone?" with time zone":""}`}}function Ve(e,t={}){return"string"===t.mode?new Me(e,t.withTimezone??!1,t.precision):new Fe(e,t.withTimezone??!1,t.precision)}class Ue extends ge{defaultRandom(){return this.default(l`gen_random_uuid()`)}build(e){return new Ie(e,this.config)}}class Ie extends me{getSQLType(){return"uuid"}}function Je(e){return new Ue(e)}class Ke{async migrate(e,t){const s=l`
			CREATE TABLE IF NOT EXISTS "drizzle"."__drizzle_migrations" (
				id SERIAL PRIMARY KEY,
				hash text NOT NULL,
				created_at bigint
			)
		`;await t.execute(l`CREATE SCHEMA IF NOT EXISTS "drizzle"`),await t.execute(s);const i=(await t.all(l`select id, hash, created_at from "drizzle"."__drizzle_migrations" order by created_at desc limit 1`))[0];await t.transaction((async t=>{for await(const s of e)if(!i||Number(i.created_at)<s.folderMillis){for(const e of s.sql)await t.execute(l.raw(e));await t.execute(l`insert into "drizzle"."__drizzle_migrations" ("hash", "created_at") values(${s.hash}, ${s.folderMillis})`)}}))}escapeName(e){return`"${e}"`}escapeParam(e){return`$${e+1}`}escapeString(e){return`'${e.replace(/'/g,"''")}'`}buildDeleteQuery({table:e,where:t,returning:s}){const i=s?l` returning ${this.buildSelection(s,{isSingleTable:!0})}`:void 0,n=t?l` where ${t}`:void 0;return l`delete from ${e}${n}${i}`}buildUpdateSet(e,t){const s=Object.entries(t),i=s.length;return l.fromList(s.flatMap((([t,s],n)=>{const r=e[o.Symbol.Columns][t],a=l`${p(r.name)} = ${s}`;return n<i-1?[a,l.raw(", ")]:[a]})))}buildUpdateQuery({table:e,set:t,where:s,returning:i}){const n=this.buildUpdateSet(e,t),r=i?l` returning ${this.buildSelection(i,{isSingleTable:!0})}`:void 0,o=s?l` where ${s}`:void 0;return l`update ${e} set ${n}${o}${r}`}buildSelection(e,{isSingleTable:t=!1}={}){const s=e.length,i=e.flatMap((({field:e},i)=>{const n=[];if(e instanceof a.Aliased&&e.isSelectionField)n.push(p(e.fieldAlias));else if(e instanceof a.Aliased||e instanceof a){const s=e instanceof a.Aliased?e.sql:e;t?n.push(new a(s.queryChunks.map((e=>e instanceof me?p(e.name):e)))):n.push(s),e instanceof a.Aliased&&n.push(l` as ${p(e.fieldAlias)}`)}else e instanceof d&&(t?n.push(p(e.name)):n.push(e));return i<s-1&&n.push(l`, `),n}));return l.fromList(i)}buildSelectQuery({withList:t,fields:s,where:i,having:n,table:r,joins:c,orderBy:h,groupBy:u,limit:y,offset:b,lockingClauses:v}){const S=e(s);for(const e of S)if(e.field instanceof d&&g(e.field.table)!==(r instanceof m?r[w].alias:r instanceof Z?r[f].name:r instanceof a?void 0:g(r))&&!(e=>c.some((({alias:t})=>t===g(e))))(e.field.table)){const t=g(e.field.table);throw new Error(`Your "${e.path.join("->")}" field references a column "${t}"."${e.field.name}", but the table "${t}" is not part of the query! Did you forget to join it?`)}const $=0===c.length;let x;if(t.length){const e=[l`with `];for(const[s,i]of t.entries())e.push(l`${p(i[w].alias)} as (${i[w].sql})`),s<t.length-1&&e.push(l`, `);e.push(l` `),x=l.fromList(e)}const N=this.buildSelection(S,{isSingleTable:$}),T=r instanceof o&&r[o.Symbol.OriginalName]!==r[o.Symbol.Name]?l`${p(r[o.Symbol.OriginalName])} ${p(r[o.Symbol.Name])}`:r,Q=[];for(const[e,t]of c.entries()){0===e&&Q.push(l` `);const s=t.table;if(s instanceof L){const e=s[L.Symbol.Name],i=s[L.Symbol.Schema],n=s[L.Symbol.OriginalName],r=e===n?void 0:t.alias;Q.push(l`${l.raw(t.joinType)} join ${i?l`${p(i)}.`:void 0}${p(n)}${r&&l` ${p(r)}`} on ${t.on}`)}else Q.push(l`${l.raw(t.joinType)} join ${s} on ${t.on}`);e<c.length-1&&Q.push(l` `)}const q=l.fromList(Q),C=i?l` where ${i}`:void 0,j=n?l` having ${n}`:void 0,z=[];for(const[e,t]of h.entries())z.push(t),e<h.length-1&&z.push(l`, `);const B=z.length>0?l` order by ${l.fromList(z)}`:void 0,D=[];for(const[e,t]of u.entries())D.push(t),e<u.length-1&&D.push(l`, `);const _=D.length>0?l` group by ${l.fromList(D)}`:void 0,A=y?l` limit ${y}`:void 0,O=b?l` offset ${b}`:void 0,P=l.empty();for(const{strength:e,config:t}of v){const s=l` for ${l.raw(e)}`;t.of&&s.append(l` of ${t.of}`),t.noWait?s.append(l` no wait`):t.skipLocked&&s.append(l` skip locked`),P.append(s)}return l`${x}select ${N} from ${T}${q}${C}${_}${j}${B}${A}${O}${P}`}buildInsertQuery({table:e,values:t,onConflict:s,returning:i}){const n=1===t.length,r=[],a=e[o.Symbol.Columns],h=n?Object.keys(t[0]).map((e=>[e,a[e]])):Object.entries(a),u=h.map((([,e])=>p(e.name)));for(const[e,s]of t.entries()){const i=[];for(const[e]of h){const t=s[e];void 0===t||t instanceof c&&void 0===t.value?i.push(l`default`):i.push(t)}r.push(i),e<t.length-1&&r.push(l`, `)}const f=l.fromList(r),d=i?l` returning ${this.buildSelection(i,{isSingleTable:!0})}`:void 0,g=s?l` on conflict ${s}`:void 0;return l`insert into ${e} ${u} values ${f}${g}${d}`}buildRefreshMaterializedViewQuery({view:e,concurrently:t,withNoData:s}){const i=t?l` concurrently`:void 0,n=s?l` with no data`:void 0;return l`refresh materialized view${i} ${e}${n}`}prepareTyping(e){return e instanceof Le||e instanceof Qe?"json":e instanceof Be?"decimal":e instanceof Oe?"time":e instanceof Ee?"timestamp":e instanceof Se?"date":e instanceof Ie?"uuid":"none"}sqlToQuery(e){return e.toQuery({escapeName:this.escapeName,escapeParam:this.escapeParam,escapeString:this.escapeString,prepareTyping:this.prepareTyping})}}class Re{constructor(e,t,s,i=[]){this.fields=e,this.session=t,this.dialect=s,this.withList=i}from(e){const t=!!this.fields;let i;return i=this.fields?this.fields:e instanceof m?Object.fromEntries(Object.keys(e[w].selection).map((t=>[t,e[t]]))):e instanceof Z?e[f].selectedFields:e instanceof a?{}:s(e),new We(e,i,t,this.session,this.dialect,this.withList)}}class Ye extends v{constructor(e,t,s,i,r,o){super(),this.isPartialSelect=s,this.session=i,this.dialect=r,this.leftJoin=this.createJoin("left"),this.rightJoin=this.createJoin("right"),this.innerJoin=this.createJoin("inner"),this.fullJoin=this.createJoin("full"),this.config={withList:o,table:e,fields:{...t},joins:[],orderBy:[],groupBy:[],lockingClauses:[]},this._={selectedFields:t},this.tableName=n(e),this.joinsNotNullableMap="string"==typeof this.tableName?{[this.tableName]:!0}:{}}createJoin(e){return(t,s)=>{const i=this.tableName,r=n(t);if("string"==typeof r&&this.config.joins.some((e=>e.alias===r)))throw new Error(`Alias "${r}" is already used in this query`);if(!(this.isPartialSelect||(1===Object.keys(this.joinsNotNullableMap).length&&"string"==typeof i&&(this.config.fields={[i]:this.config.fields}),"string"!=typeof r||t instanceof a))){const e=t instanceof m?t[w].selection:t instanceof u?t[f].selectedFields:t[o.Symbol.Columns];this.config.fields[r]=e}if("function"==typeof s&&(s=s(new Proxy(this.config.fields,new h({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.joins.push({on:s,table:t,joinType:e,alias:r}),"string"==typeof r)switch(e){case"left":this.joinsNotNullableMap[r]=!1;break;case"right":this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map((([e])=>[e,!1]))),this.joinsNotNullableMap[r]=!0;break;case"inner":this.joinsNotNullableMap[r]=!0;break;case"full":this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map((([e])=>[e,!1]))),this.joinsNotNullableMap[r]=!1}return this}}where(e){return"function"==typeof e&&(e=e(new Proxy(this.config.fields,new h({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.where=e,this}having(e){return"function"==typeof e&&(e=e(new Proxy(this.config.fields,new h({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.having=e,this}groupBy(...e){if("function"==typeof e[0]){const t=e[0](new Proxy(this.config.fields,new h({sqlAliasedBehavior:"alias",sqlBehavior:"sql"})));this.config.groupBy=Array.isArray(t)?t:[t]}else this.config.groupBy=e;return this}orderBy(...e){if("function"==typeof e[0]){const t=e[0](new Proxy(this.config.fields,new h({sqlAliasedBehavior:"alias",sqlBehavior:"sql"})));this.config.orderBy=Array.isArray(t)?t:[t]}else this.config.orderBy=e;return this}limit(e){return this.config.limit=e,this}offset(e){return this.config.offset=e,this}for(e,t={}){return this.config.lockingClauses.push({strength:e,config:t}),this}getSQL(){return this.dialect.buildSelectQuery(this.config)}toSQL(){const{typings:e,...t}=this.dialect.sqlToQuery(this.getSQL());return t}as(e){return new Proxy(new m(this.getSQL(),this.config.fields,e),new h({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}}class We extends Ye{constructor(){super(...arguments),this.execute=e=>this._prepare().execute(e)}_prepare(t){if(!this.session)throw new Error("Cannot execute a query on a query builder. Please use a database instance instead.");const s=e(this.config.fields),i=this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),s,t);return i.joinsNotNullableMap=this.joinsNotNullableMap,i}prepare(e){return this._prepare(e)}}i(We,[b]);class Xe{$with(e){const t=this;return{as:s=>("function"==typeof s&&(s=s(t)),new Proxy(new y(s.getSQL(),s.getSelectedFields(),e,!0),new h({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}}with(...e){const t=this;return{select:function(s){return new Re(s??void 0,void 0,t.getDialect(),e)}}}select(e){return new Re(e??void 0,void 0,this.getDialect())}getDialect(){return this.dialect||(this.dialect=new Ke),this.dialect}}class He extends b{constructor(e,t,s){super(),this.session=t,this.dialect=s,this.execute=e=>this._prepare().execute(e),this.config={view:e}}concurrently(){if(void 0!==this.config.withNoData)throw new Error("Cannot use concurrently and withNoData together");return this.config.concurrently=!0,this}withNoData(){if(void 0!==this.config.concurrently)throw new Error("Cannot use concurrently and withNoData together");return this.config.withNoData=!0,this}getSQL(){return this.dialect.buildRefreshMaterializedViewQuery(this.config)}toSQL(){const{typings:e,...t}=this.dialect.sqlToQuery(this.getSQL());return t}_prepare(e){return this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),void 0,e)}prepare(e){return this._prepare(e)}}class Ge{constructor(e,t,s){this.table=e,this.session=t,this.dialect=s}set(e){return new Ze(this.table,t(this.table,e),this.session,this.dialect)}}class Ze extends b{constructor(e,t,s,i){super(),this.session=s,this.dialect=i,this.execute=e=>this._prepare().execute(e),this.config={set:t,table:e}}where(e){return this.config.where=e,this}returning(t=this.config.table[o.Symbol.Columns]){return this.config.returning=e(t),this}getSQL(){return this.dialect.buildUpdateQuery(this.config)}toSQL(){const{typings:e,...t}=this.dialect.sqlToQuery(this.getSQL());return t}_prepare(e){return this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e)}prepare(e){return this._prepare(e)}}class et{constructor(e,t){this.dialect=e,this.session=t}$with(e){return{as:t=>("function"==typeof t&&(t=t(new Xe)),new Proxy(new y(t.getSQL(),t.getSelectedFields(),e,!0),new h({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}}with(...e){const t=this;return{select:function(s){return new Re(s??void 0,t.session,t.dialect,e)}}}select(e){return new Re(e??void 0,this.session,this.dialect)}update(e){return new Ge(e,this.session,this.dialect)}insert(e){return new x(e,this.session,this.dialect)}delete(e){return new $(e,this.session,this.dialect)}refreshMaterializedView(e){return new He(e,this.session,this.dialect)}execute(e){return this.session.execute(e.getSQL())}transaction(e,t){return this.session.transaction(e,t)}}class tt{}class st{constructor(e){this.dialect=e}execute(e){return this.prepareQuery(this.dialect.sqlToQuery(e),void 0,void 0).execute()}all(e){return this.prepareQuery(this.dialect.sqlToQuery(e),void 0,void 0).all()}}class it extends et{constructor(e,t,s=0){super(e,t),this.nestedIndex=s}rollback(){throw new r}getTransactionConfigSQL(e){const t=[];return e.isolationLevel&&t.push(`isolation level ${e.isolationLevel}`),e.accessMode&&t.push(e.accessMode),"boolean"==typeof e.deferrable&&t.push(e.deferrable?"deferrable":"not deferrable"),l.raw(t.join(" "))}setTransaction(e){return this.session.execute(l`set transaction ${this.getTransactionConfigSQL(e)}`)}}export{x as $,De as A,_e as B,D as C,Ae as D,Oe as E,Pe as F,Fe as G,Ee as H,Me as I,ke as J,Ve as K,Ue as L,Ie as M,Je as N,O,tt as P,P as Q,F as R,E as S,M as T,k as U,V,U as W,I as X,J as Y,K as Z,$ as _,st as a,N as a0,Xe as a1,He as a2,Re as a3,Ye as a4,We as a5,Ge as a6,Ze as a7,q as a8,C as a9,L as aa,z as ab,B as ac,ce as ad,le as ae,he as af,fe as ag,de as ah,pe as ai,R as aj,Y as ak,W as al,X as am,H as an,G as ao,Z as ap,ee as aq,te as ar,se as as,ie as at,oe as au,ae as av,it as b,Ke as c,et as d,ge as e,me as f,ne as g,re as h,_ as i,A as j,we as k,ye as l,ve as m,Se as n,$e as o,j as p,xe as q,Ne as r,Te as s,Qe as t,qe as u,Ce as v,Le as w,je as x,ze as y,Be as z};
//# sourceMappingURL=session-c891400d.mjs.map
