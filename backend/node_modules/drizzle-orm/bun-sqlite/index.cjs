"use strict";var e=require("../logger-04bad527.cjs"),s=require("../session-b6939bab.cjs"),t=require("../index-59b7992d.cjs"),r=require("../utils-9d882195.cjs");require("../query-builder-2f2e8229.cjs");class i extends s.SQLiteSession{constructor(s,t,r={}){super(t),this.client=s,this.logger=r.logger??new e.NoopLogger}exec(e){this.client.exec(e)}prepareQuery(e,s){const t=this.client.prepare(e.sql);return new l(t,e.sql,e.params,this.logger,s)}transaction(e,s={}){const t=new n(this.dialect,this);let r;return this.client.transaction((()=>{r=e(t)}))[s.behavior??"deferred"](),r}}class n extends s.SQLiteTransaction{transaction(e){const s=`sp${this.nestedIndex}`,r=new n(this.dialect,this.session,this.nestedIndex+1);this.session.run(t.sql.raw(`savepoint ${s}`));try{const i=e(r);return this.session.run(t.sql.raw(`release savepoint ${s}`)),i}catch(e){throw this.session.run(t.sql.raw(`rollback to savepoint ${s}`)),e}}}class l extends s.PreparedQuery{constructor(e,s,t,r,i){super(),this.stmt=e,this.queryString=s,this.params=t,this.logger=r,this.fields=i}run(e){const s=t.fillPlaceholders(this.params,e??{});return this.logger.logQuery(this.queryString,s),this.stmt.run(...s)}all(e){const{fields:s,queryString:i,logger:n,joinsNotNullableMap:l,stmt:o}=this;if(s)return this.values(e).map((e=>r.mapResultRow(s,e,l)));const a=t.fillPlaceholders(this.params,e??{});return n.logQuery(i,a),o.all(...a)}get(e){const s=t.fillPlaceholders(this.params,e??{});this.logger.logQuery(this.queryString,s);const i=this.stmt.get(...s);if(!i)return;const{fields:n,joinsNotNullableMap:l}=this;return n?r.mapResultRow(n,i,l):i}values(e){const s=t.fillPlaceholders(this.params,e??{});return this.logger.logQuery(this.queryString,s),this.stmt.values(...s)}}exports.PreparedQuery=l,exports.SQLiteBunSession=i,exports.SQLiteBunTransaction=n,exports.drizzle=function(t,r={}){const n=new s.SQLiteSyncDialect;let l;!0===r.logger?l=new e.DefaultLogger:!1!==r.logger&&(l=r.logger);const o=new i(t,n,{logger:l});return new s.BaseSQLiteDatabase(n,o)};
//# sourceMappingURL=index.cjs.map
