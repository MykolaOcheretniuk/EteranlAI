class e{constructor(e,s){this.table=e,this.config=s,this.name=s.name,this.notNull=s.notNull,this.default=s.default,this.hasDefault=s.hasDefault,this.primary=s.primaryKey}mapFromDriverValue(e){return e}mapToDriverValue(e){return e}}var s;const n=Symbol("Name"),r=Symbol("Schema"),a=Symbol("Columns"),t=Symbol("OriginalName"),i=Symbol("BaseName"),o=Symbol("IsAlias");class l{constructor(e,a,o){this[s]=!1,this[n]=this[t]=e,this[r]=a,this[i]=o}}function u(e){return e[n]}s=o,l.Symbol={Name:n,Schema:r,OriginalName:t,Columns:a,BaseName:i,IsAlias:o};const c=Symbol("ViewBaseConfig");class m{constructor({name:e,schema:s,selectedFields:n,query:r}){this[c]={name:e,originalName:e,schema:s,selectedFields:n,query:r,isExisting:!r,isAlias:!1}}}class f{constructor(e){this.table=e}get(e,s){return"table"===s?this.table:e[s]}}class h{constructor(e,s){this.alias=e,this.replaceOriginalName=s}get(s,n){if(n===l.Symbol.IsAlias)return!0;if(n===l.Symbol.Name)return this.alias;if(this.replaceOriginalName&&n===l.Symbol.OriginalName)return this.alias;if(n===c)return{...s[c],name:this.alias,isAlias:!0};if(n===l.Symbol.Columns){const e=s[l.Symbol.Columns];if(!e)return e;const n={};return Object.keys(e).map((r=>{n[r]=new Proxy(e[r],new f(new Proxy(s,this)))})),n}const r=s[n];return r instanceof e?new Proxy(r,new f(new Proxy(s,this))):r}}const p=Symbol("SubqueryConfig");class y{constructor(e,s,n,r=!1){this[p]={sql:e,selection:s,alias:n,isWith:r}}}class d extends y{}class b{constructor(e){this.config={...e}}get(s,n){if(n===p)return{...s[p],selection:new Proxy(s[p].selection,this)};if(n===c)return{...s[c],selectedFields:new Proxy(s[c].selectedFields,this)};if("symbol"==typeof n)return s[n];const r=(s instanceof y?s[p].selection:s instanceof m?s[c].selectedFields:s)[n];if(r instanceof q.Aliased){if("sql"===this.config.sqlAliasedBehavior&&!r.isSelectionField)return r.sql;const e=r.clone();return e.isSelectionField=!0,e}if(r instanceof q){if("sql"===this.config.sqlBehavior)return r;throw new Error(`You tried to reference "${n}" field from a subquery, which is a raw SQL field, but it doesn't have an alias declared. Please add an alias to the field using ".as('alias')" method.`)}return r instanceof e?this.config.alias?new Proxy(r,new f(new Proxy(r.table,new h(this.config.alias,this.config.replaceOriginalName??!1)))):r:"object"!=typeof r||null===r?r:new Proxy(r,new b(this.config))}}class w{}function S(e){return"object"==typeof e&&null!==e&&"getSQL"in e&&"function"==typeof e.getSQL}class g{constructor(e){this.value=Array.isArray(e)?e:[e]}}class q{constructor(e){this.queryChunks=e,this.decoder=F,this.shouldInlineParams=!1}append(e){return this.queryChunks.push(...e.queryChunks),this}toQuery(e){return this.buildQueryFromSourceParams(this.queryChunks,e)}buildQueryFromSourceParams(s,n){const r=Object.assign({},n,{inlineParams:n.inlineParams||this.shouldInlineParams,paramStartIndex:n.paramStartIndex||{value:0}}),{escapeName:a,escapeParam:t,prepareTyping:i,inlineParams:o,paramStartIndex:u}=r;return function(e){const s={sql:"",params:[]};for(const n of e)s.sql+=n.sql,s.params.push(...n.params),s.typings&&n.typings?.length&&s.typings.push(...n.typings);return s}(s.map((s=>{if(s instanceof g)return{sql:s.value.join(""),params:[]};if(s instanceof v)return{sql:a(s.value),params:[]};if(void 0===s)return{sql:"",params:[]};if(Array.isArray(s)){const e=[new g("(")];for(const[n,r]of s.entries())e.push(r),n<s.length-1&&e.push(new g(", "));return e.push(new g(")")),this.buildQueryFromSourceParams(e,r)}if(s instanceof q)return this.buildQueryFromSourceParams(s.queryChunks,{...r,inlineParams:o||s.shouldInlineParams});if(s instanceof l){const e=s[l.Symbol.Schema],n=s[l.Symbol.Name];return{sql:void 0===e?a(n):a(e)+"."+a(n),params:[]}}if(s instanceof e)return{sql:a(s.table[l.Symbol.Name])+"."+a(s.name),params:[]};if(s instanceof m){const e=s[c].schema,n=s[c].name;return{sql:void 0===e?a(n):a(e)+"."+a(n),params:[]}}if(s instanceof I){const e=null===s.value?null:s.encoder.mapToDriverValue(s.value);if(e instanceof q)return this.buildQueryFromSourceParams([e],r);if(o)return{sql:this.mapInlineParam(e,r),params:[]};let n;return void 0!==i&&(n=[i(s.encoder)]),{sql:t(u.value++,e),params:[e],typings:n}}return s instanceof q.Aliased&&void 0!==s.fieldAlias?{sql:a(s.fieldAlias),params:[]}:s instanceof y?s[p].isWith?{sql:a(s[p].alias),params:[]}:this.buildQueryFromSourceParams([new g("("),s[p].sql,new g(") "),new v(s[p].alias)],r):S(s)?this.buildQueryFromSourceParams([new g("("),s.getSQL(),new g(")")],r):o?{sql:this.mapInlineParam(s,r),params:[]}:{sql:t(u.value++,s),params:[s]}})))}mapInlineParam(e,{escapeString:s}){if(null===e)return"null";if("number"==typeof e||"boolean"==typeof e)return e.toString();if("string"==typeof e)return s(e);if("object"==typeof e){const n=e.toString();return s("[object Object]"===n?JSON.stringify(e):n)}throw new Error("Unexpected param value: "+e)}getSQL(){return this}as(e){return void 0===e?this:new q.Aliased(this,e)}mapWith(e){return this.decoder="function"==typeof e?{mapFromDriverValue:e}:e,this}inlineParams(){return this.shouldInlineParams=!0,this}}class v{constructor(e){this.value=e}}function P(e){return new v(e)}function N(e){return"object"==typeof e&&null!==e&&"mapToDriverValue"in e&&"function"==typeof e.mapToDriverValue}const F={mapFromDriverValue:e=>e},A={mapToDriverValue:e=>e},x={...F,...A};class I{constructor(e,s=A){this.value=e,this.encoder=s}}function Q(e,s){return new I(e,s)}function C(e,...s){const n=[];(s.length>0||e.length>0&&""!==e[0])&&n.push(new g(e[0]));for(const[r,a]of s.entries())n.push(a,new g(e[r+1]));return new q(n)}!function(e){e.empty=function(){return new q([])},e.fromList=function(e){return new q(e)},e.raw=function(e){return new q([new g(e)])},e.join=function(s,n){const r=[];for(const[e,a]of s.entries())e>0&&r.push(n),r.push(a);return e.fromList(r)}}(C||(C={})),function(e){class s{constructor(e,s){this.sql=e,this.fieldAlias=s,this.isSelectionField=!1}getSQL(){return this.sql}clone(){return new s(this.sql,this.fieldAlias)}}e.Aliased=s}(q||(q={}));class j{constructor(e){this.name=e}}function O(e){return new j(e)}function D(e,s){return e.map((e=>{if(e instanceof j){if(!(e.name in s))throw new Error(`No value for placeholder "${e.name}" was provided`);return s[e.name]}return e}))}export{i as B,e as C,w as F,o as I,v as N,t as O,I as P,g as S,l as T,m as V,d as W,S as a,j as b,f as c,h as d,q as e,F as f,A as g,x as h,N as i,O as j,D as k,p as l,y as m,P as n,b as o,Q as p,n as q,r,C as s,a as t,u,c as v};
//# sourceMappingURL=index-b71998f1.mjs.map
