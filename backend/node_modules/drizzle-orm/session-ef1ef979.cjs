"use strict";var e,t,i=require("./utils-9d882195.cjs"),s=require("./index-59b7992d.cjs"),n=require("./query-promise-2c5b43ab.cjs"),r=require("./query-builder-2f2e8229.cjs"),o=require("./column-builder-b48639f3.cjs");class a extends n.QueryPromise{constructor(e,t,i){super(),this.session=t,this.dialect=i,this.execute=e=>this._prepare().execute(e),this.config={table:e}}where(e){return this.config.where=e,this}returning(e=this.config.table[s.Table.Symbol.Columns]){return this.config.returning=i.orderSelectedFields(e),this}getSQL(){return this.dialect.buildDeleteQuery(this.config)}toSQL(){const{typings:e,...t}=this.dialect.sqlToQuery(this.getSQL());return t}_prepare(e){return this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e)}prepare(e){return this._prepare(e)}}class l{constructor(e,t,i){this.table=e,this.session=t,this.dialect=i}values(e){if(0===(e=Array.isArray(e)?e:[e]).length)throw new Error("values() must be called with at least one value");const t=e.map((e=>{const t={},i=this.table[s.Table.Symbol.Columns];for(const n of Object.keys(e)){const r=e[n];t[n]=r instanceof s.SQL?r:new s.Param(r,i[n])}return t}));return new c(this.table,t,this.session,this.dialect)}}class c extends n.QueryPromise{constructor(e,t,i,s){super(),this.session=i,this.dialect=s,this.execute=e=>this._prepare().execute(e),this.config={table:e,values:t}}returning(e=this.config.table[s.Table.Symbol.Columns]){return this.config.returning=i.orderSelectedFields(e),this}onConflictDoNothing(e={}){if(void 0===e.target)this.config.onConflict=s.sql`do nothing`;else{let t="";t=Array.isArray(e.target)?e.target.map((e=>this.dialect.escapeName(e.name))).join(","):this.dialect.escapeName(e.target.name);const i=e.where?s.sql` where ${e.where}`:s.sql``;this.config.onConflict=s.sql`(${s.sql.raw(t)})${i} do nothing`}return this}onConflictDoUpdate(e){const t=e.where?s.sql` where ${e.where}`:s.sql``,n=this.dialect.buildUpdateSet(this.config.table,i.mapUpdateSet(this.config.table,e.set));let r="";return r=Array.isArray(e.target)?e.target.map((e=>this.dialect.escapeName(e.name))).join(","):this.dialect.escapeName(e.target.name),this.config.onConflict=s.sql`(${s.sql.raw(r)})${t} do update set ${n}`,this}getSQL(){return this.dialect.buildInsertQuery(this.config)}toSQL(){const{typings:e,...t}=this.dialect.sqlToQuery(this.getSQL());return t}_prepare(e){return this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e)}prepare(e){return this._prepare(e)}}const u=Symbol("InlineForeignKeys"),h=Symbol("ExtraConfigBuilder");class d extends s.Table{constructor(){super(...arguments),this[e]=[],this[t]=void 0}}function p(e,t,i,n,r=e){const o=new d(e,n,r),a=Object.fromEntries(Object.entries(t).map((([e,t])=>{const i=t.build(o);return o[u].push(...t.buildForeignKeys(i,o)),[e,i]}))),l=Object.assign(o,a);return l[s.Table.Symbol.Columns]=a,i&&(l[d.Symbol.ExtraConfigBuilder]=i),l}e=u,t=h,d.Symbol=Object.assign({},s.Table.Symbol,{InlineForeignKeys:u,ExtraConfigBuilder:h});const g=(e,t,i)=>p(e,t,i,void 0);class f{constructor(e,t){this.name=e,this.value=t}build(e){return new m(e,this)}}class m{constructor(e,t){this.table=e,this.name=t.name,this.value=t.value}}class y{constructor(e,t){this._onUpdate="no action",this._onDelete="no action",this.reference=()=>{const{columns:t,foreignColumns:i}=e();return{columns:t,foreignTable:i[0].table,foreignColumns:i}},t&&(this._onUpdate=t.onUpdate,this._onDelete=t.onDelete)}onUpdate(e){return this._onUpdate=void 0===e?"no action":e,this}onDelete(e){return this._onDelete=void 0===e?"no action":e,this}build(e){return new w(e,this)}}class w{constructor(e,t){this.table=e,this.reference=t.reference,this.onUpdate=t._onUpdate,this.onDelete=t._onDelete}getName(){const{columns:e,foreignColumns:t}=this.reference(),i=e.map((e=>e.name)),s=t.map((e=>e.name));return`${[this.table[d.Symbol.Name],...i,t[0].table[d.Symbol.Name],...s].join("_")}_fk`}}class b{constructor(e,t){this.unique=e,this.name=t}on(...e){return new x(e,this.unique,!1,this.name)}onOnly(...e){return new x(e,this.unique,!0,this.name)}}class x{constructor(e,t,i,s){this.config={name:s,columns:e,unique:t,only:i}}concurrently(){return this.config.concurrently=!0,this}using(e){return this.config.using=e,this}asc(){return this.config.order="asc",this}desc(){return this.config.order="desc",this}nullsFirst(){return this.config.nulls="first",this}nullsLast(){return this.config.nulls="last",this}where(e){return this.config.where=e,this}build(e){return new S(this.config,e)}}class S{constructor(e,t){this.config={...e,table:t}}}class q{constructor(e){this.columns=e}build(e){return new v(e,this.columns)}}class v{constructor(e,t){this.table=e,this.columns=t}getName(){return`${this.table[d.Symbol.Name]}_${this.columns.map((e=>e.name)).join("_")}_pk`}}class T{constructor(e,t){this.name=e,this.schema=t,this.config={}}with(e){return this.config.with=e,this}}class $ extends T{as(e){"function"==typeof e&&(e=e(new me));const t=new s.SelectionProxyHandler({alias:this.name,sqlBehavior:"error",sqlAliasedBehavior:"alias",replaceOriginalName:!0}),i=new Proxy(e.getSelectedFields(),t);return new Proxy(new j({pgConfig:this.config,config:{name:this.name,schema:this.schema,selectedFields:i,query:e.getSQL().inlineParams()}}),t)}}class P extends T{constructor(e,t,s){super(e,s),this.columns=i.getTableColumns(g(e,t))}existing(){return new Proxy(new j({pgConfig:void 0,config:{name:this.name,schema:this.schema,selectedFields:this.columns,query:void 0}}),new s.SelectionProxyHandler({alias:this.name,sqlBehavior:"error",sqlAliasedBehavior:"alias",replaceOriginalName:!0}))}as(e){return new Proxy(new j({pgConfig:this.config,config:{name:this.name,schema:this.schema,selectedFields:this.columns,query:e.inlineParams()}}),new s.SelectionProxyHandler({alias:this.name,sqlBehavior:"error",sqlAliasedBehavior:"alias",replaceOriginalName:!0}))}}class Q{constructor(e,t){this.name=e,this.schema=t,this.config={}}using(e){return this.config.using=e,this}with(e){return this.config.with=e,this}tablespace(e){return this.config.tablespace=e,this}withNoData(){return this.config.withNoData=!0,this}}class C extends Q{as(e){"function"==typeof e&&(e=e(new me));const t=new s.SelectionProxyHandler({alias:this.name,sqlBehavior:"error",sqlAliasedBehavior:"alias",replaceOriginalName:!0}),i=new Proxy(e.getSelectedFields(),t);return new Proxy(new z({pgConfig:{with:this.config.with,using:this.config.using,tablespace:this.config.tablespace,withNoData:this.config.withNoData},config:{name:this.name,schema:this.schema,selectedFields:i,query:e.getSQL().inlineParams()}}),t)}}class N extends Q{constructor(e,t,s){super(e,s),this.columns=i.getTableColumns(g(e,t))}existing(){return new Proxy(new z({pgConfig:void 0,config:{name:this.name,schema:this.schema,selectedFields:this.columns,query:void 0}}),new s.SelectionProxyHandler({alias:this.name,sqlBehavior:"error",sqlAliasedBehavior:"alias",replaceOriginalName:!0}))}as(e){return new Proxy(new z({pgConfig:void 0,config:{name:this.name,schema:this.schema,selectedFields:this.columns,query:e.inlineParams()}}),new s.SelectionProxyHandler({alias:this.name,sqlBehavior:"error",sqlAliasedBehavior:"alias",replaceOriginalName:!0}))}}class B extends s.View{}const L=Symbol("PgViewConfig");class j extends B{constructor({pgConfig:e,config:t}){super(t),e&&(this[L]={with:e.with})}}const D=Symbol("PgMaterializedViewConfig");class z extends B{constructor({pgConfig:e,config:t}){super(t),this[D]={with:e?.with,using:e?.using,tablespace:e?.tablespace,withNoData:e?.withNoData}}}function _(e,t,i){return t?new P(e,t,i):new $(e,i)}function A(e,t,i){return t?new N(e,t,i):new C(e,i)}function V(e,t,i){for(let s=t;s<e.length;s++){const n=e[s];if("\\"!==n){if('"'===n)return[e.slice(t,s).replace(/\\/g,""),s+1];if(!i&&(","===n||"}"===n))return[e.slice(t,s).replace(/\\/g,""),s]}else s++}return[e.slice(t).replace(/\\/g,""),e.length]}function O(e,t=0){const i=[];let s=t,n=!1;for(;s<e.length;){const r=e[s];if(","===r){(n||s===t)&&i.push(""),n=!0,s++;continue}if(n=!1,"\\"===r){s+=2;continue}if('"'===r){const[t,n]=V(e,s+1,!0);i.push(t),s=n;continue}if("}"===r)return[i,s+1];if("{"===r){const[t,n]=O(e,s+1);i.push(t),s=n;continue}const[o,a]=V(e,s,!1);i.push(o),s=a}return[i,s]}function F(e){const[t]=O(e,1);return t}function M(e){return`{${e.map((e=>Array.isArray(e)?M(e):"string"==typeof e&&e.includes(",")?`"${e.replace(/"/g,'\\"')}"`:`${e}`)).join(",")}}`}class k extends o.ColumnBuilder{constructor(){super(...arguments),this.foreignKeyConfigs=[]}array(e){return new U(this.config.name,this,e)}references(e,t={}){return this.foreignKeyConfigs.push({ref:e,actions:t}),this}buildForeignKeys(e,t){return this.foreignKeyConfigs.map((({ref:i,actions:s})=>((i,s)=>{const n=new y((()=>{const t=i();return{columns:[e],foreignColumns:[t]}}));return s.onUpdate&&n.onUpdate(s.onUpdate),s.onDelete&&n.onDelete(s.onDelete),n.build(t)})(i,s)))}}class E extends s.Column{}class U extends k{constructor(e,t,i){super(e),this.config.baseBuilder=t,this.config.size=i}build(e){const t=this.config.baseBuilder.build(e);return new I(e,this.config,t)}}class I extends E{constructor(e,t,i,s){super(e,t),this.baseColumn=i,this.range=s,this.size=t.size}getSQLType(){return`${this.baseColumn.getSQLType()}[${"number"==typeof this.size?this.size:""}]`}mapFromDriverValue(e){return"string"==typeof e&&(e=F(e)),e.map((e=>this.baseColumn.mapFromDriverValue(e)))}mapToDriverValue(e,t=!1){const i=e.map((e=>null===e?null:this.baseColumn instanceof I?this.baseColumn.mapToDriverValue(e,!0):this.baseColumn.mapToDriverValue(e)));return t?i:M(i)}}class K extends k{defaultNow(){return this.default(s.sql`now()`)}}class J extends K{build(e){return new H(e,this.config)}}class H extends E{getSQLType(){return"date"}mapFromDriverValue(e){return new Date(e)}mapToDriverValue(e){return e.toISOString()}}class R extends K{build(e){return new W(e,this.config)}}class W extends E{getSQLType(){return"date"}}class Y extends k{build(e){return new X(e,this.config)}}class X extends E{constructor(e,t){super(e,t)}getSQLType(){return"json"}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){if("string"==typeof e)try{return JSON.parse(e)}catch{return e}return e}}class G extends k{build(e){return new Z(e,this.config)}}class Z extends E{constructor(e,t){super(e,t)}getSQLType(){return"jsonb"}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){if("string"==typeof e)try{return JSON.parse(e)}catch{return e}return e}}class ee extends k{constructor(e,t,i){super(e),this.config.precision=t,this.config.scale=i}build(e){return new te(e,this.config)}}class te extends E{constructor(e,t){super(e,t),this.precision=t.precision,this.scale=t.scale}getSQLType(){return void 0!==this.precision&&void 0!==this.scale?`numeric(${this.precision}, ${this.scale})`:void 0===this.precision?"numeric":`numeric(${this.precision})`}}function ie(e,t){return new ee(e,t?.precision,t?.scale)}const se=ie;class ne extends K{constructor(e,t,i){super(e),this.withTimezone=t,this.precision=i,this.config.withTimezone=t,this.config.precision=i}build(e){return new re(e,this.config)}}class re extends E{constructor(e,t){super(e,t),this.withTimezone=t.withTimezone,this.precision=t.precision}getSQLType(){return`time${void 0===this.precision?"":`(${this.precision})`}${this.withTimezone?" with time zone":""}`}}class oe extends K{constructor(e,t,i){super(e),this.config.withTimezone=t,this.config.precision=i}build(e){return new ae(e,this.config)}}class ae extends E{constructor(e,t){super(e,t),this.mapFromDriverValue=e=>new Date(this.withTimezone?e:e+"+0000"),this.mapToDriverValue=e=>this.withTimezone?e.toUTCString():e.toISOString(),this.withTimezone=t.withTimezone,this.precision=t.precision}getSQLType(){return`timestamp${void 0===this.precision?"":` (${this.precision})`}${this.withTimezone?" with time zone":""}`}}class le extends K{constructor(e,t,i){super(e),this.config.withTimezone=t,this.config.precision=i}build(e){return new ce(e,this.config)}}class ce extends E{constructor(e,t){super(e,t),this.withTimezone=t.withTimezone,this.precision=t.precision}getSQLType(){return`timestamp${void 0===this.precision?"":`(${this.precision})`}${this.withTimezone?" with time zone":""}`}}class ue extends k{defaultRandom(){return this.default(s.sql`gen_random_uuid()`)}build(e){return new he(e,this.config)}}class he extends E{getSQLType(){return"uuid"}}class de{async migrate(e,t){const i=s.sql`
			CREATE TABLE IF NOT EXISTS "drizzle"."__drizzle_migrations" (
				id SERIAL PRIMARY KEY,
				hash text NOT NULL,
				created_at bigint
			)
		`;await t.execute(s.sql`CREATE SCHEMA IF NOT EXISTS "drizzle"`),await t.execute(i);const n=(await t.all(s.sql`select id, hash, created_at from "drizzle"."__drizzle_migrations" order by created_at desc limit 1`))[0];await t.transaction((async t=>{for await(const i of e)if(!n||Number(n.created_at)<i.folderMillis){for(const e of i.sql)await t.execute(s.sql.raw(e));await t.execute(s.sql`insert into "drizzle"."__drizzle_migrations" ("hash", "created_at") values(${i.hash}, ${i.folderMillis})`)}}))}escapeName(e){return`"${e}"`}escapeParam(e){return`$${e+1}`}escapeString(e){return`'${e.replace(/'/g,"''")}'`}buildDeleteQuery({table:e,where:t,returning:i}){const n=i?s.sql` returning ${this.buildSelection(i,{isSingleTable:!0})}`:void 0,r=t?s.sql` where ${t}`:void 0;return s.sql`delete from ${e}${r}${n}`}buildUpdateSet(e,t){const i=Object.entries(t),n=i.length;return s.sql.fromList(i.flatMap((([t,i],r)=>{const o=e[s.Table.Symbol.Columns][t],a=s.sql`${s.name(o.name)} = ${i}`;return r<n-1?[a,s.sql.raw(", ")]:[a]})))}buildUpdateQuery({table:e,set:t,where:i,returning:n}){const r=this.buildUpdateSet(e,t),o=n?s.sql` returning ${this.buildSelection(n,{isSingleTable:!0})}`:void 0,a=i?s.sql` where ${i}`:void 0;return s.sql`update ${e} set ${r}${a}${o}`}buildSelection(e,{isSingleTable:t=!1}={}){const i=e.length,n=e.flatMap((({field:e},n)=>{const r=[];if(e instanceof s.SQL.Aliased&&e.isSelectionField)r.push(s.name(e.fieldAlias));else if(e instanceof s.SQL.Aliased||e instanceof s.SQL){const i=e instanceof s.SQL.Aliased?e.sql:e;t?r.push(new s.SQL(i.queryChunks.map((e=>e instanceof E?s.name(e.name):e)))):r.push(i),e instanceof s.SQL.Aliased&&r.push(s.sql` as ${s.name(e.fieldAlias)}`)}else e instanceof s.Column&&(t?r.push(s.name(e.name)):r.push(e));return n<i-1&&r.push(s.sql`, `),r}));return s.sql.fromList(n)}buildSelectQuery({withList:e,fields:t,where:n,having:r,table:o,joins:a,orderBy:l,groupBy:c,limit:u,offset:h,lockingClauses:p}){const g=i.orderSelectedFields(t);for(const e of g)if(e.field instanceof s.Column&&s.getTableName(e.field.table)!==(o instanceof s.Subquery?o[s.SubqueryConfig].alias:o instanceof B?o[s.ViewBaseConfig].name:o instanceof s.SQL?void 0:s.getTableName(o))&&!(e=>a.some((({alias:t})=>t===s.getTableName(e))))(e.field.table)){const t=s.getTableName(e.field.table);throw new Error(`Your "${e.path.join("->")}" field references a column "${t}"."${e.field.name}", but the table "${t}" is not part of the query! Did you forget to join it?`)}const f=0===a.length;let m;if(e.length){const t=[s.sql`with `];for(const[i,n]of e.entries())t.push(s.sql`${s.name(n[s.SubqueryConfig].alias)} as (${n[s.SubqueryConfig].sql})`),i<e.length-1&&t.push(s.sql`, `);t.push(s.sql` `),m=s.sql.fromList(t)}const y=this.buildSelection(g,{isSingleTable:f}),w=o instanceof s.Table&&o[s.Table.Symbol.OriginalName]!==o[s.Table.Symbol.Name]?s.sql`${s.name(o[s.Table.Symbol.OriginalName])} ${s.name(o[s.Table.Symbol.Name])}`:o,b=[];for(const[e,t]of a.entries()){0===e&&b.push(s.sql` `);const i=t.table;if(i instanceof d){const e=i[d.Symbol.Name],n=i[d.Symbol.Schema],r=i[d.Symbol.OriginalName],o=e===r?void 0:t.alias;b.push(s.sql`${s.sql.raw(t.joinType)} join ${n?s.sql`${s.name(n)}.`:void 0}${s.name(r)}${o&&s.sql` ${s.name(o)}`} on ${t.on}`)}else b.push(s.sql`${s.sql.raw(t.joinType)} join ${i} on ${t.on}`);e<a.length-1&&b.push(s.sql` `)}const x=s.sql.fromList(b),S=n?s.sql` where ${n}`:void 0,q=r?s.sql` having ${r}`:void 0,v=[];for(const[e,t]of l.entries())v.push(t),e<l.length-1&&v.push(s.sql`, `);const T=v.length>0?s.sql` order by ${s.sql.fromList(v)}`:void 0,$=[];for(const[e,t]of c.entries())$.push(t),e<c.length-1&&$.push(s.sql`, `);const P=$.length>0?s.sql` group by ${s.sql.fromList($)}`:void 0,Q=u?s.sql` limit ${u}`:void 0,C=h?s.sql` offset ${h}`:void 0,N=s.sql.empty();for(const{strength:e,config:t}of p){const i=s.sql` for ${s.sql.raw(e)}`;t.of&&i.append(s.sql` of ${t.of}`),t.noWait?i.append(s.sql` no wait`):t.skipLocked&&i.append(s.sql` skip locked`),N.append(i)}return s.sql`${m}select ${y} from ${w}${x}${S}${P}${q}${T}${Q}${C}${N}`}buildInsertQuery({table:e,values:t,onConflict:i,returning:n}){const r=1===t.length,o=[],a=e[s.Table.Symbol.Columns],l=r?Object.keys(t[0]).map((e=>[e,a[e]])):Object.entries(a),c=l.map((([,e])=>s.name(e.name)));for(const[e,i]of t.entries()){const n=[];for(const[e]of l){const t=i[e];void 0===t||t instanceof s.Param&&void 0===t.value?n.push(s.sql`default`):n.push(t)}o.push(n),e<t.length-1&&o.push(s.sql`, `)}const u=s.sql.fromList(o),h=n?s.sql` returning ${this.buildSelection(n,{isSingleTable:!0})}`:void 0,d=i?s.sql` on conflict ${i}`:void 0;return s.sql`insert into ${e} ${c} values ${u}${d}${h}`}buildRefreshMaterializedViewQuery({view:e,concurrently:t,withNoData:i}){const n=t?s.sql` concurrently`:void 0,r=i?s.sql` with no data`:void 0;return s.sql`refresh materialized view${n} ${e}${r}`}prepareTyping(e){return e instanceof Z||e instanceof X?"json":e instanceof te?"decimal":e instanceof re?"time":e instanceof ae?"timestamp":e instanceof H?"date":e instanceof he?"uuid":"none"}sqlToQuery(e){return e.toQuery({escapeName:this.escapeName,escapeParam:this.escapeParam,escapeString:this.escapeString,prepareTyping:this.prepareTyping})}}class pe{constructor(e,t,i,s=[]){this.fields=e,this.session=t,this.dialect=i,this.withList=s}from(e){const t=!!this.fields;let n;return n=this.fields?this.fields:e instanceof s.Subquery?Object.fromEntries(Object.keys(e[s.SubqueryConfig].selection).map((t=>[t,e[t]]))):e instanceof B?e[s.ViewBaseConfig].selectedFields:e instanceof s.SQL?{}:i.getTableColumns(e),new fe(e,n,t,this.session,this.dialect,this.withList)}}class ge extends r.TypedQueryBuilder{constructor(e,t,s,n,r,o){super(),this.isPartialSelect=s,this.session=n,this.dialect=r,this.leftJoin=this.createJoin("left"),this.rightJoin=this.createJoin("right"),this.innerJoin=this.createJoin("inner"),this.fullJoin=this.createJoin("full"),this.config={withList:o,table:e,fields:{...t},joins:[],orderBy:[],groupBy:[],lockingClauses:[]},this._={selectedFields:t},this.tableName=i.getTableLikeName(e),this.joinsNotNullableMap="string"==typeof this.tableName?{[this.tableName]:!0}:{}}createJoin(e){return(t,n)=>{const r=this.tableName,o=i.getTableLikeName(t);if("string"==typeof o&&this.config.joins.some((e=>e.alias===o)))throw new Error(`Alias "${o}" is already used in this query`);if(!(this.isPartialSelect||(1===Object.keys(this.joinsNotNullableMap).length&&"string"==typeof r&&(this.config.fields={[r]:this.config.fields}),"string"!=typeof o||t instanceof s.SQL))){const e=t instanceof s.Subquery?t[s.SubqueryConfig].selection:t instanceof s.View?t[s.ViewBaseConfig].selectedFields:t[s.Table.Symbol.Columns];this.config.fields[o]=e}if("function"==typeof n&&(n=n(new Proxy(this.config.fields,new s.SelectionProxyHandler({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.joins.push({on:n,table:t,joinType:e,alias:o}),"string"==typeof o)switch(e){case"left":this.joinsNotNullableMap[o]=!1;break;case"right":this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map((([e])=>[e,!1]))),this.joinsNotNullableMap[o]=!0;break;case"inner":this.joinsNotNullableMap[o]=!0;break;case"full":this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map((([e])=>[e,!1]))),this.joinsNotNullableMap[o]=!1}return this}}where(e){return"function"==typeof e&&(e=e(new Proxy(this.config.fields,new s.SelectionProxyHandler({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.where=e,this}having(e){return"function"==typeof e&&(e=e(new Proxy(this.config.fields,new s.SelectionProxyHandler({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.having=e,this}groupBy(...e){if("function"==typeof e[0]){const t=e[0](new Proxy(this.config.fields,new s.SelectionProxyHandler({sqlAliasedBehavior:"alias",sqlBehavior:"sql"})));this.config.groupBy=Array.isArray(t)?t:[t]}else this.config.groupBy=e;return this}orderBy(...e){if("function"==typeof e[0]){const t=e[0](new Proxy(this.config.fields,new s.SelectionProxyHandler({sqlAliasedBehavior:"alias",sqlBehavior:"sql"})));this.config.orderBy=Array.isArray(t)?t:[t]}else this.config.orderBy=e;return this}limit(e){return this.config.limit=e,this}offset(e){return this.config.offset=e,this}for(e,t={}){return this.config.lockingClauses.push({strength:e,config:t}),this}getSQL(){return this.dialect.buildSelectQuery(this.config)}toSQL(){const{typings:e,...t}=this.dialect.sqlToQuery(this.getSQL());return t}as(e){return new Proxy(new s.Subquery(this.getSQL(),this.config.fields,e),new s.SelectionProxyHandler({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}}class fe extends ge{constructor(){super(...arguments),this.execute=e=>this._prepare().execute(e)}_prepare(e){if(!this.session)throw new Error("Cannot execute a query on a query builder. Please use a database instance instead.");const t=i.orderSelectedFields(this.config.fields),s=this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),t,e);return s.joinsNotNullableMap=this.joinsNotNullableMap,s}prepare(e){return this._prepare(e)}}i.applyMixins(fe,[n.QueryPromise]);class me{$with(e){const t=this;return{as:i=>("function"==typeof i&&(i=i(t)),new Proxy(new s.WithSubquery(i.getSQL(),i.getSelectedFields(),e,!0),new s.SelectionProxyHandler({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}}with(...e){const t=this;return{select:function(i){return new pe(i??void 0,void 0,t.getDialect(),e)}}}select(e){return new pe(e??void 0,void 0,this.getDialect())}getDialect(){return this.dialect||(this.dialect=new de),this.dialect}}class ye extends n.QueryPromise{constructor(e,t,i){super(),this.session=t,this.dialect=i,this.execute=e=>this._prepare().execute(e),this.config={view:e}}concurrently(){if(void 0!==this.config.withNoData)throw new Error("Cannot use concurrently and withNoData together");return this.config.concurrently=!0,this}withNoData(){if(void 0!==this.config.concurrently)throw new Error("Cannot use concurrently and withNoData together");return this.config.withNoData=!0,this}getSQL(){return this.dialect.buildRefreshMaterializedViewQuery(this.config)}toSQL(){const{typings:e,...t}=this.dialect.sqlToQuery(this.getSQL());return t}_prepare(e){return this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),void 0,e)}prepare(e){return this._prepare(e)}}class we{constructor(e,t,i){this.table=e,this.session=t,this.dialect=i}set(e){return new be(this.table,i.mapUpdateSet(this.table,e),this.session,this.dialect)}}class be extends n.QueryPromise{constructor(e,t,i,s){super(),this.session=i,this.dialect=s,this.execute=e=>this._prepare().execute(e),this.config={set:t,table:e}}where(e){return this.config.where=e,this}returning(e=this.config.table[s.Table.Symbol.Columns]){return this.config.returning=i.orderSelectedFields(e),this}getSQL(){return this.dialect.buildUpdateQuery(this.config)}toSQL(){const{typings:e,...t}=this.dialect.sqlToQuery(this.getSQL());return t}_prepare(e){return this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e)}prepare(e){return this._prepare(e)}}class xe{constructor(e,t){this.dialect=e,this.session=t}$with(e){return{as:t=>("function"==typeof t&&(t=t(new me)),new Proxy(new s.WithSubquery(t.getSQL(),t.getSelectedFields(),e,!0),new s.SelectionProxyHandler({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}}with(...e){const t=this;return{select:function(i){return new pe(i??void 0,t.session,t.dialect,e)}}}select(e){return new pe(e??void 0,this.session,this.dialect)}update(e){return new we(e,this.session,this.dialect)}insert(e){return new l(e,this.session,this.dialect)}delete(e){return new a(e,this.session,this.dialect)}refreshMaterializedView(e){return new ye(e,this.session,this.dialect)}execute(e){return this.session.execute(e.getSQL())}transaction(e,t){return this.session.transaction(e,t)}}exports.Check=m,exports.CheckBuilder=f,exports.DefaultViewBuilderCore=T,exports.ExtraConfigBuilder=h,exports.ForeignKey=w,exports.ForeignKeyBuilder=y,exports.Index=S,exports.IndexBuilder=x,exports.IndexBuilderOn=b,exports.InlineForeignKeys=u,exports.ManualMaterializedViewBuilder=N,exports.ManualViewBuilder=P,exports.MaterializedViewBuilder=C,exports.MaterializedViewBuilderCore=Q,exports.PgArray=I,exports.PgArrayBuilder=U,exports.PgColumn=E,exports.PgColumnBuilder=k,exports.PgDatabase=xe,exports.PgDate=H,exports.PgDateBuilder=J,exports.PgDateString=W,exports.PgDateStringBuilder=R,exports.PgDelete=a,exports.PgDialect=de,exports.PgInsert=c,exports.PgInsertBuilder=l,exports.PgJson=X,exports.PgJsonBuilder=Y,exports.PgJsonb=Z,exports.PgJsonbBuilder=G,exports.PgMaterializedView=z,exports.PgMaterializedViewConfig=D,exports.PgNumeric=te,exports.PgNumericBuilder=ee,exports.PgRefreshMaterializedView=ye,exports.PgSelect=fe,exports.PgSelectBuilder=pe,exports.PgSelectQueryBuilder=ge,exports.PgSession=class{constructor(e){this.dialect=e}execute(e){return this.prepareQuery(this.dialect.sqlToQuery(e),void 0,void 0).execute()}all(e){return this.prepareQuery(this.dialect.sqlToQuery(e),void 0,void 0).all()}},exports.PgTable=d,exports.PgTime=re,exports.PgTimeBuilder=ne,exports.PgTimestamp=ae,exports.PgTimestampBuilder=oe,exports.PgTimestampString=ce,exports.PgTimestampStringBuilder=le,exports.PgTransaction=class extends xe{constructor(e,t,i=0){super(e,t),this.nestedIndex=i}rollback(){throw new i.TransactionRollbackError}getTransactionConfigSQL(e){const t=[];return e.isolationLevel&&t.push(`isolation level ${e.isolationLevel}`),e.accessMode&&t.push(e.accessMode),"boolean"==typeof e.deferrable&&t.push(e.deferrable?"deferrable":"not deferrable"),s.sql.raw(t.join(" "))}setTransaction(e){return this.session.execute(s.sql`set transaction ${this.getTransactionConfigSQL(e)}`)}},exports.PgUUID=he,exports.PgUUIDBuilder=ue,exports.PgUpdate=be,exports.PgUpdateBuilder=we,exports.PgView=j,exports.PgViewBase=B,exports.PgViewConfig=L,exports.PreparedQuery=class{},exports.PrimaryKey=v,exports.PrimaryKeyBuilder=q,exports.QueryBuilder=me,exports.ViewBuilder=$,exports.check=function(e,t){return new f(e,t)},exports.date=function(e,t){return"date"===t?.mode?new J(e):new R(e)},exports.decimal=se,exports.foreignKey=function(e){return new y((function(){const{columns:t,foreignColumns:i}=e;return{columns:t,foreignColumns:i}}))},exports.getMaterializedViewConfig=function(e){return{...e[s.ViewBaseConfig],...e[D]}},exports.getTableConfig=function(e){const t=Object.values(e[s.Table.Symbol.Columns]),i=[],n=[],r=[],o=Object.values(e[d.Symbol.InlineForeignKeys]),a=e[s.Table.Symbol.Name],l=e[s.Table.Symbol.Schema],c=e[d.Symbol.ExtraConfigBuilder];if(void 0!==c){const t=c(e[s.Table.Symbol.Columns]);for(const s of Object.values(t))s instanceof x?i.push(s.build(e)):s instanceof f?n.push(s.build(e)):s instanceof q?r.push(s.build(e)):s instanceof y&&o.push(s.build(e))}return{columns:t,indexes:i,foreignKeys:o,checks:n,primaryKeys:r,name:a,schema:l}},exports.getViewConfig=function(e){return{...e[s.ViewBaseConfig],...e[L]}},exports.index=function(e){return new b(!1,e)},exports.json=function(e){return new Y(e)},exports.jsonb=function(e){return new G(e)},exports.makePgArray=M,exports.numeric=ie,exports.parsePgArray=F,exports.parsePgNestedArray=O,exports.pgMaterializedView=function(e,t){return A(e,t,void 0)},exports.pgMaterializedViewWithSchema=A,exports.pgTable=g,exports.pgTableCreator=function(e){return(t,i,s)=>p(e(t),i,s,void 0,t)},exports.pgTableWithSchema=p,exports.pgView=function(e,t){return _(e,t,void 0)},exports.pgViewWithSchema=_,exports.primaryKey=function(...e){return new q(e)},exports.time=function(e,t={}){return new ne(e,t.withTimezone??!1,t.precision)},exports.timestamp=function(e,t={}){return"string"===t.mode?new le(e,t.withTimezone??!1,t.precision):new oe(e,t.withTimezone??!1,t.precision)},exports.uniqueIndex=function(e){return new b(!0,e)},exports.uuid=function(e){return new ue(e)};
//# sourceMappingURL=session-ef1ef979.cjs.map
